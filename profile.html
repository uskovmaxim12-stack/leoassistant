<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Мой профиль - Leo Assistant</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <script>
        // Проверка авторизации
        if (!localStorage.getItem('loggedIn')) {
            window.location.href = 'index.html';
        }
    </script>
    
    <div class="dashboard-layout">
        <!-- Сайдбар -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="user-info">
                    <div class="user-avatar" id="profileAvatar">МУ</div>
                    <div class="user-details">
                        <h3 id="profileName">Максим Усков</h3>
                        <div class="user-class">7Б КЛАСС</div>
                        <div class="status-online">
                            <span class="status-dot"></span>
                            <span>ONLINE</span>
                        </div>
                    </div>
                </div>
                <div class="user-id">
                    <small>ID: <strong id="profileId">30683</strong></small>
                </div>
            </div>

            <nav>
                <ul class="nav-menu">
                    <li class="nav-item"><a href="dashboard.html" class="nav-link"><i class="fas fa-home"></i><span>Главная</span></a></li>
                    <li class="nav-item"><a href="assistant.html" class="nav-link"><i class="fas fa-robot"></i><span>Лео Ассистент</span></a></li>
                    <li class="nav-item"><a href="friends.html" class="nav-link"><i class="fas fa-user-friends"></i><span>Друзья</span></a></li>
                    <li class="nav-item"><a href="schedule.html" class="nav-link"><i class="fas fa-calendar-alt"></i><span>Расписание</span></a></li>
                    <li class="nav-item"><a href="homework.html" class="nav-link"><i class="fas fa-book"></i><span>Домашка</span></a></li>
                    <li class="nav-item"><a href="profile.html" class="nav-link active"><i class="fas fa-user-cog"></i><span>Мой профиль</span></a></li>
                    <li class="nav-item"><a href="admin.html" class="nav-link"><i class="fas fa-shield-alt"></i><span>Админ</span></a></li>
                    <li class="nav-item"><a href="#" onclick="logout()" class="nav-link"><i class="fas fa-sign-out-alt"></i><span>Выйти</span></a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <header class="header">
                <div>
                    <h1><i class="fas fa-user-circle"></i> Мой профиль</h1>
                    <p class="subtitle">Управление вашим аккаунтом и настройками</p>
                </div>
                <div class="header-actions">
                    <button class="btn-secondary" onclick="toggleEditMode()" id="editBtn">
                        <i class="fas fa-edit"></i> Редактировать
                    </button>
                </div>
            </header>

            <div class="profile-container">
                <!-- ЛЕВАЯ КОЛОНКА - ИНФОРМАЦИЯ -->
                <div class="profile-left">
                    <!-- ОСНОВНАЯ ИНФОРМАЦИЯ -->
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-id-card"></i> Основная информация</h3>
                        </div>
                        <div class="form-group">
                            <label>Фамилия</label>
                            <input type="text" id="surname" value="Усков" readonly>
                        </div>
                        <div class="form-group">
                            <label>Имя</label>
                            <input type="text" id="name" value="Максим" readonly>
                        </div>
                        <div class="form-group">
                            <label>Игровой ник</label>
                            <input type="text" id="username" value="Макс" placeholder="Придумайте себе ник..." readonly>
                            <small class="hint">Будет отображаться у друзей</small>
                        </div>
                        <div class="form-group">
                            <label>Класс</label>
                            <input type="text" value="7Б" readonly>
                        </div>
                    </div>

                    <!-- ОПИСАНИЕ -->
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-file-alt"></i> О себе</h3>
                        </div>
                        <div class="form-group">
                            <label>Описание профиля</label>
                            <textarea id="description" rows="4" placeholder="Расскажите о себе..." readonly>Ученик 7Б класса, увлекаюсь программированием и математикой</textarea>
                            <div class="char-counter">
                                <span id="charCount">0</span>/100 символов
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ПРАВАЯ КОЛОНКА - СТАТИСТИКА -->
                <div class="profile-right">
                    <!-- ID ПРОФИЛЯ -->
                    <div class="card highlight">
                        <div class="card-header">
                            <h3><i class="fas fa-fingerprint"></i> ID профиля</h3>
                        </div>
                        <div class="profile-id">
                            <div class="id-number">30683</div>
                            <p class="id-hint">
                                <i class="fas fa-share-alt"></i>
                                Поделитесь этим ID, чтобы друзья могли вас найти
                            </p>
                            <button class="btn-secondary" onclick="copyId()">
                                <i class="fas fa-copy"></i> Копировать ID
                            </button>
                        </div>
                    </div>

                    <!-- СТАТИСТИКА -->
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-line"></i> Ваша статистика</h3>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-icon">
                                    <i class="fas fa-rocket"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value">450</div>
                                    <div class="stat-label">Очки (✈)</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">
                                    <i class="fas fa-layer-group"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value">3</div>
                                    <div class="stat-label">Уровень</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">
                                    <i class="fas fa-calendar"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value">7</div>
                                    <div class="stat-label">Дней в системе</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value" id="friendsCount">0</div>
                                    <div class="stat-label">Друзей</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ПРОГРЕСС УРОВНЯ -->
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-trophy"></i> Прогресс уровня</h3>
                        </div>
                        <div class="level-progress">
                            <div class="level-info">
                                <span class="current-level">Уровень 3</span>
                                <span class="next-level">Уровень 4: 500 очков</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 90%"></div>
                            </div>
                            <div class="progress-text">
                                <span>450/500 очков</span>
                                <span>Осталось: 50 очков</span>
                            </div>
                        </div>
                        <div class="progress-tips">
                            <p><i class="fas fa-lightbulb"></i> Как получить больше очков:</p>
                            <ul>
                                <li>Задавайте вопросы Лео (+10 очков)</li>
                                <li>Выполняйте ДЗ (+50 очков)</li>
                                <li>Будьте активны каждый день (+5 очков)</li>
                            </ul>
                        </div>
                    </div>

                    <!-- СМЕНА ПАРОЛЯ -->
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-lock"></i> Безопасность</h3>
                        </div>
                        <div class="security-options">
                            <button class="btn-secondary" onclick="showChangePassword()">
                                <i class="fas fa-key"></i> Сменить пароль
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- КНОПКИ СОХРАНЕНИЯ -->
            <div class="action-buttons" id="actionButtons" style="display: none;">
                <button class="btn-secondary" onclick="cancelEdit()">
                    <i class="fas fa-times"></i> Отмена
                </button>
                <button class="btn-primary" onclick="saveProfile()">
                    <i class="fas fa-save"></i> Сохранить изменения
                </button>
            </div>
        </main>
    </div>

    <!-- МОДАЛЬНОЕ ОКНО СМЕНЫ ПАРОЛЯ -->
    <div id="changePasswordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> Смена пароля</h3>
                <button class="modal-close" onclick="closePasswordModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Текущий пароль</label>
                    <input type="password" id="currentPassword" placeholder="Введите текущий пароль">
                </div>
                <div class="form-group">
                    <label>Новый пароль</label>
                    <input type="password" id="newPassword" placeholder="5 цифр (например: 54321)">
                </div>
                <div class="form-group">
                    <label>Повторите новый пароль</label>
                    <input type="password" id="confirmPassword" placeholder="Повторите новый пароль">
                </div>
                <div class="password-rules">
                    <p><i class="fas fa-info-circle"></i> Правила пароля:</p>
                    <ul>
                        <li>Только цифры (0-9)</li>
                        <li>Ровно 5 символов</li>
                        <li>Не используйте простые комбинации (12345, 11111)</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closePasswordModal()">Отмена</button>
                <button class="btn-primary" onclick="changePassword()">Сменить пароль</button>
            </div>
        </div>
    </div>

    <script>
        let editMode = false;
        let originalData = {};

        document.addEventListener('DOMContentLoaded', () => {
            loadProfileData();
            setupCharCounter();
        });

        function loadProfileData() {
            // Устанавливаем значения
            document.getElementById('surname').value = 'Усков';
            document.getElementById('name').value = 'Максим';
            document.getElementById('username').value = 'Макс';
            document.getElementById('description').value = 'Ученик 7Б класса, увлекаюсь программированием и математикой';
            document.getElementById('profileId').textContent = '30683';
            document.getElementById('profileName').textContent = 'Максим Усков';
            document.getElementById('profileAvatar').textContent = 'МУ';

            // Сохраняем оригинальные данные
            originalData = {
                username: 'Макс',
                description: 'Ученик 7Б класса, увлекаюсь программированием и математикой'
            };

            // Загружаем статистику друзей
            const friends = JSON.parse(localStorage.getItem('leo_friends') || '[]');
            document.getElementById('friendsCount').textContent = friends.length;
        }

        function setupCharCounter() {
            const textarea = document.getElementById('description');
            const counter = document.getElementById('charCount');

            function updateCounter() {
                const length = textarea.value.length;
                counter.textContent = length;

                if (length > 100) {
                    counter.style.color = 'var(--danger)';
                    textarea.value = textarea.value.substring(0, 100);
                    updateCounter();
                } else if (length > 80) {
                    counter.style.color = 'var(--warning)';
                } else {
                    counter.style.color = 'var(--text)';
                }
            }

            textarea.addEventListener('input', updateCounter);
            updateCounter();
        }

        function toggleEditMode() {
            editMode = !editMode;
            const inputs = document.querySelectorAll('#username, #description');
            const editBtn = document.getElementById('editBtn');
            const actionButtons = document.getElementById('actionButtons');

            if (editMode) {
                // Включаем редактирование
                inputs.forEach(input => {
                    input.removeAttribute('readonly');
                    input.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
                });

                editBtn.innerHTML = '<i class="fas fa-times"></i> Отменить';
                editBtn.classList.remove('btn-secondary');
                editBtn.classList.add('btn-danger');
                editBtn.onclick = cancelEdit;

                actionButtons.style.display = 'flex';
            } else {
                cancelEdit();
            }
        }

        function cancelEdit() {
            editMode = false;
            const inputs = document.querySelectorAll('#username, #description');
            const editBtn = document.getElementById('editBtn');
            const actionButtons = document.getElementById('actionButtons');

            // Восстанавливаем оригинальные значения
            document.getElementById('username').value = originalData.username;
            document.getElementById('description').value = originalData.description;

            // Отключаем редактирование
            inputs.forEach(input => {
                input.setAttribute('readonly', true);
                input.style.backgroundColor = '';
            });

            editBtn.innerHTML = '<i class="fas fa-edit"></i> Редактировать';
            editBtn.classList.remove('btn-danger');
            editBtn.classList.add('btn-secondary');
            editBtn.onclick = toggleEditMode;

            actionButtons.style.display = 'none';
        }

        function saveProfile() {
            const username = document.getElementById('username').value.trim();
            const description = document.getElementById('description').value.trim();

            if (username.length < 2) {
                alert('Игровой ник должен содержать минимум 2 символа');
                return;
            }

            if (description.length > 100) {
                alert('Описание не должно превышать 100 символов');
                return;
            }

            // Сохраняем в localStorage
            originalData.username = username;
            originalData.description = description;

            alert('Изменения сохранены!');

            // Выходим из режима редактирования
            const editBtn = document.getElementById('editBtn');
            editMode = false;
            editBtn.innerHTML = '<i class="fas fa-edit"></i> Редактировать';
            editBtn.classList.remove('btn-danger');
            editBtn.classList.add('btn-secondary');
            editBtn.onclick = toggleEditMode;

            document.getElementById('actionButtons').style.display = 'none';

            // Обновляем интерфейс
            document.getElementById('username').setAttribute('readonly', true);
            document.getElementById('description').setAttribute('readonly', true);

            // Обновляем аватар если изменился ник
            if (username.length >= 2) {
                document.getElementById('profileAvatar').textContent = username.substring(0, 2).toUpperCase();
            }
        }

        function copyId() {
            const id = document.getElementById('profileId').textContent;
            navigator.clipboard.writeText(id).then(() => {
                alert('ID скопирован в буфер обмена!');
            }).catch(() => {
                // Fallback для старых браузеров
                const tempInput = document.createElement('input');
                tempInput.value = id;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                alert('ID скопирован!');
            });
        }

        function showChangePassword() {
            document.getElementById('changePasswordModal').style.display = 'flex';
        }

        function closePasswordModal() {
            document.getElementById('changePasswordModal').style.display = 'none';
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        function changePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;

            if (current !== '12345') {
                alert('Неверный текущий пароль');
                return;
            }

            if (!/^\d{5}$/.test(newPass)) {
                alert('Новый пароль должен содержать ровно 5 цифр');
                return;
            }

            if (newPass !== confirm) {
                alert('Пароли не совпадают');
                return;
            }

            if (newPass === '12345') {
                alert('Новый пароль не должен совпадать со старым');
                return;
            }

            alert('Пароль успешно изменен!');
            closePasswordModal();
        }

        function logout() {
            localStorage.removeItem('loggedIn');
            localStorage.removeItem('username');
            localStorage.removeItem('userId');
            window.location.href = 'index.html';
        }

        // Закрытие модального окна при клике вне его
        window.onclick = function(event) {
            const modal = document.getElementById('changePasswordModal');
            if (event.target === modal) {
                closePasswordModal();
            }
        }
    </script>

    <style>
        .profile-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .profile-container {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--secondary);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .card.highlight {
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .card-header h3 {
            font-size: 1.1rem;
            color: var(--accent-light);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
        }

        .form-group input[readonly],
        .form-group textarea[readonly] {
            background: rgba(255, 255, 255, 0.03);
            color: var(--text-secondary);
            cursor: not-allowed;
        }

        .hint {
            display: block;
            margin-top: 5px;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .char-counter {
            text-align: right;
            margin-top: 5px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .profile-id {
            text-align: center;
            padding: 20px 0;
        }

        .id-number {
            font-size: 3rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-family: monospace;
        }

        .id-hint {
            color: var(--text-secondary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            background: var(--accent);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-light);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .level-progress {
            margin-bottom: 20px;
        }

        .level-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .current-level {
            color: var(--accent);
            font-weight: 500;
        }

        .next-level {
            color: var(--text-secondary);
        }

        .progress-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #8b5cf6);
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .progress-tips {
            background: rgba(245, 158, 11, 0.1);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .progress-tips p {
            color: var(--warning);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-tips ul {
            margin: 0;
            padding-left: 20px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .progress-tips li {
            margin-bottom: 5px;
        }

        .security-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .btn-primary, .btn-secondary, .btn-danger {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            border: 1px solid var(--danger);
        }

        .password-rules {
            background: rgba(59, 130, 246, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .password-rules p {
            color: var(--accent);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .password-rules ul {
            margin: 0;
            padding-left: 20px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Модальное окно */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--secondary);
            border-radius: var(--radius);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        @media (max-width: 768px) {
            .profile-container {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .security-options {
                flex-direction: column;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</body>
</html>