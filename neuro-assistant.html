<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroLeo Assistant ü§ñ | Leo Assistant</title>
    
    <!-- –°—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="../css/core.css">
    <link rel="stylesheet" href="../css/animations.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- –ù–µ–π—Ä–æ-—Å—Ç–∏–ª–∏ -->
    <style>
        .neuro-page {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
        .neuro-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .neuro-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .neuro-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), #8b5cf6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            animation: pulse-glow 2s infinite;
        }
        
        .neuro-info h1 {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .neuro-status {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–∞—Ç–∞ */
        .neuro-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
            height: calc(100vh - 200px);
        }
        
        @media (max-width: 1024px) {
            .neuro-container {
                grid-template-columns: 1fr;
                height: auto;
            }
        }
        
        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .neuro-sidebar {
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            padding: 25px;
            border: 1px solid var(--border);
            overflow-y: auto;
        }
        
        .personality-selector {
            margin-bottom: 30px;
        }
        
        .personality-selector h3 {
            margin-bottom: 15px;
            color: var(--text-primary);
        }
        
        .personality-options {
            display: grid;
            gap: 10px;
        }
        
        .personality-option {
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: all var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .personality-option:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }
        
        .personality-option.active {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--primary);
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .neuro-stats {
            margin: 30px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius);
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        /* –ë—ã—Å—Ç—Ä—ã–µ –≤–æ–ø—Ä–æ—Å—ã */
        .quick-questions h3 {
            margin-bottom: 15px;
        }
        
        .question-chip {
            display: inline-block;
            padding: 8px 15px;
            margin: 0 10px 10px 0;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 20px;
            color: var(--primary-light);
            cursor: pointer;
            transition: all var(--transition);
        }
        
        .question-chip:hover {
            background: rgba(59, 130, 246, 0.2);
            transform: translateY(-2px);
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç */
        .neuro-chat {
            display: flex;
            flex-direction: column;
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            overflow: hidden;
        }
        
        .chat-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .message {
            display: flex;
            gap: 15px;
            max-width: 80%;
            animation: slideUp 0.3s ease;
        }
        
        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .message.user .message-avatar {
            background: var(--primary);
            color: white;
        }
        
        .message.ai .message-avatar {
            background: linear-gradient(135deg, var(--primary), #8b5cf6);
            color: white;
        }
        
        .message-content {
            padding: 15px;
            border-radius: 15px;
            position: relative;
        }
        
        .message.user .message-content {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-top-right-radius: 0;
        }
        
        .message.ai .message-content {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-top-left-radius: 0;
        }
        
        .message-text {
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .message-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .message-category {
            background: rgba(59, 130, 246, 0.2);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
        }
        
        /* –í–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è */
        .chat-input {
            padding: 20px;
            border-top: 1px solid var(--border);
            background: rgba(0, 0, 0, 0.2);
        }
        
        .input-container {
            display: flex;
            gap: 15px;
        }
        
        .input-container textarea {
            flex: 1;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 1rem;
            resize: none;
            min-height: 60px;
            max-height: 120px;
        }
        
        .input-container textarea:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .send-button {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            width: 60px;
            cursor: pointer;
            transition: all var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .send-button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .input-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .action-button {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 20px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all var(--transition);
        }
        
        .action-button:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π */
        @keyframes typing {
            0% { opacity: 0.3; }
            50% { opacity: 1; }
            100% { opacity: 0.3; }
        }
        
        .typing-indicator {
            display: flex;
            gap: 5px;
            padding: 20px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        /* –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä */
        .emotion-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .neuro-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .neuro-title {
                flex-direction: column;
                text-align: center;
            }
            
            .message {
                max-width: 90%;
            }
            
            .input-container {
                flex-direction: column;
            }
            
            .send-button {
                width: 100%;
                height: 50px;
            }
        }
        
        /* –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
        .category-math { color: #6366f1; }
        .category-russian { color: #3b82f6; }
        .category-history { color: #f59e0b; }
        .category-science { color: #10b981; }
        .category-english { color: #ec4899; }
    </style>
</head>
<body>
    <!-- –ü—Ä–µ–ª–æ–∞–¥–µ—Ä -->
    <div class="preloader" id="preloader">
        <div class="neuro-loader">
            <div class="neuron"></div>
            <div class="neuron"></div>
            <div class="neuron"></div>
            <p>–ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç NeuroLeo... <span id="loadPercent">0%</span></p>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="app-container">
        <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ -->
        <div class="back-button">
            <a href="dashboard.html" class="btn-secondary">
                <i class="fas fa-arrow-left"></i> –ù–∞ –≥–ª–∞–≤–Ω—É—é
            </a>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ–π—Ä–æ-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ -->
        <div class="page active neuro-page" id="neuro-page">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="neuro-header">
                <div class="neuro-title">
                    <div class="neuro-avatar">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="neuro-info">
                        <h1 class="gradient-text">NeuroLeo Assistant</h1>
                        <div class="neuro-status">
                            <span class="status-dot"></span>
                            <span id="currentPersonality">–ü–æ–º–æ—â–Ω—ã–π —É—á–∏—Ç–µ–ª—å</span>
                            ‚Ä¢
                            <span id="currentEmotion" class="emotion-indicator">
                                <span id="emotionEmoji">üòå</span>
                                <span id="emotionText">–°–ø–æ–∫–æ–π–Ω—ã–π</span>
                            </span>
                            ‚Ä¢
                            <span id="knowledgeCount">–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–Ω–∞–Ω–∏–π: 0</span>
                        </div>
                    </div>
                </div>
                
                <div class="neuro-actions">
                    <button class="btn-secondary" onclick="exportConversation()">
                        <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç
                    </button>
                    <button class="btn-secondary" onclick="clearConversation()">
                        <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                    <button class="btn-primary" onclick="showNeuroSettings()">
                        <i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                    </button>
                </div>
            </div>

            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
            <div class="neuro-container">
                <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
                <div class="neuro-sidebar">
                    <!-- –í—ã–±–æ—Ä –ª–∏—á–Ω–æ—Å—Ç–∏ -->
                    <div class="personality-selector">
                        <h3><i class="fas fa-mask"></i> –õ–∏—á–Ω–æ—Å—Ç—å AI</h3>
                        <div class="personality-options" id="personalityOptions">
                            <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                        </div>
                    </div>

                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="neuro-stats">
                        <h3><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                        <div class="stat-item">
                            <span>–í—Å–µ–≥–æ –¥–∏–∞–ª–æ–≥–æ–≤:</span>
                            <span id="totalDialogs">0</span>
                        </div>
                        <div class="stat-item">
                            <span>–°–µ–≥–æ–¥–Ω—è:</span>
                            <span id="todayDialogs">0</span>
                        </div>
                        <div class="stat-item">
                            <span>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:</span>
                            <span id="confidenceLevel">85%</span>
                        </div>
                        <div class="stat-item">
                            <span>–û–±—É—á–µ–Ω–∏–µ:</span>
                            <span id="learningProgress">100%</span>
                        </div>
                    </div>

                    <!-- –ë—ã—Å—Ç—Ä—ã–µ –≤–æ–ø—Ä–æ—Å—ã -->
                    <div class="quick-questions">
                        <h3><i class="fas fa-bolt"></i> –ë—ã—Å—Ç—Ä—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h3>
                        <div id="quickQuestions">
                            <div class="question-chip" onclick="askQuestion('–ß—Ç–æ —Ç–∞–∫–æ–µ —Ç–µ–æ—Ä–µ–º–∞ –ü–∏—Ñ–∞–≥–æ—Ä–∞?')">
                                –¢–µ–æ—Ä–µ–º–∞ –ü–∏—Ñ–∞–≥–æ—Ä–∞
                            </div>
                            <div class="question-chip" onclick="askQuestion('–ö–∞–∫ —Ä–µ—à–∞—Ç—å –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è?')">
                                –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è
                            </div>
                            <div class="question-chip" onclick="askQuestion('–û–±—ä—è—Å–Ω–∏ –ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ü–µ—Ç—Ä–∞ I')">
                                –ü–µ—Ç—Ä I
                            </div>
                            <div class="question-chip" onclick="askQuestion('–ß—Ç–æ —Ç–∞–∫–æ–µ —Ñ–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑?')">
                                –§–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑
                            </div>
                            <div class="question-chip" onclick="askQuestion('–ü—Ä–∞–≤–∏–ª–∞ —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞')">
                                –†—É—Å—Å–∫–∏–π —è–∑—ã–∫
                            </div>
                            <div class="question-chip" onclick="askQuestion('–ö–∞–∫ —É—á–∏—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å–ª–æ–≤–∞?')">
                                –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å–ª–æ–≤–∞
                            </div>
                        </div>
                    </div>

                    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–Ω–∞–Ω–∏–π -->
                    <div class="knowledge-categories" style="margin-top: 30px;">
                        <h3><i class="fas fa-book"></i> –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</h3>
                        <div id="knowledgeCategories">
                            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                        </div>
                    </div>
                </div>

                <!-- –û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç -->
                <div class="neuro-chat">
                    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞ -->
                    <div class="chat-header">
                        <div>
                            <h3><i class="fas fa-comments"></i> –î–∏–∞–ª–æ–≥ —Å NeuroLeo</h3>
                            <p class="text-muted" id="conversationInfo">–ù–∞—á–Ω–∏—Ç–µ –¥–∏–∞–ª–æ–≥, –∑–∞–¥–∞–≤ –≤–æ–ø—Ä–æ—Å</p>
                        </div>
                        <div class="chat-controls">
                            <button class="btn-secondary" onclick="toggleVoice()" id="voiceToggle">
                                <i class="fas fa-microphone"></i> –ì–æ–ª–æ—Å
                            </button>
                        </div>
                    </div>

                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
                    <div class="chat-messages" id="chatMessages">
                        <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
                        <div class="message ai">
                            <div class="message-avatar">
                                <i class="fas fa-brain"></i>
                            </div>
                            <div class="message-content">
                                <div class="message-text">
                                    –ü—Ä–∏–≤–µ—Ç! –Ø NeuroLeo ‚Äî —Ç–≤–æ–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ —É—á—ë–±–µ. ü§ñ
                                    <br><br>
                                    –Ø –º–æ–≥—É –ø–æ–º–æ—á—å —Å –ª—é–±—ã–º —à–∫–æ–ª—å–Ω—ã–º –ø—Ä–µ–¥–º–µ—Ç–æ–º: –æ–±—ä—è—Å–Ω–∏—Ç—å —Ç–µ–º—É, —Ä–µ—à–∏—Ç—å –∑–∞–¥–∞—á—É, 
                                    –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å –æ–± —É—á—ë–±–µ.
                                    <br><br>
                                    –ó–∞–¥–∞–π –º–Ω–µ –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –≤—ã–±–µ—Ä–∏ –±—ã—Å—Ç—Ä—ã–π –≤–æ–ø—Ä–æ—Å —Å–ª–µ–≤–∞!
                                </div>
                                <div class="message-meta">
                                    <span class="message-category">üëã –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ</span>
                                    <span>–¢–æ–ª—å–∫–æ —á—Ç–æ</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ -->
                    <div class="typing-indicator" id="typingIndicator" style="display: none;">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <span style="margin-left: 10px; color: var(--text-secondary);">
                            NeuroLeo –¥—É–º–∞–µ—Ç...
                        </span>
                    </div>

                    <!-- –í–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è -->
                    <div class="chat-input">
                        <div class="input-container">
                            <textarea 
                                id="messageInput" 
                                placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –ø–æ –ª—é–±–æ–º—É –ø—Ä–µ–¥–º–µ—Ç—É..."
                                rows="1"
                                onkeydown="handleInputKeydown(event)"
                            ></textarea>
                            <button class="send-button" onclick="sendMessage()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        
                        <div class="input-actions">
                            <button class="action-button" onclick="insertExample()">
                                <i class="fas fa-magic"></i> –ü—Ä–∏–º–µ—Ä –≤–æ–ø—Ä–æ—Å–∞
                            </button>
                            <button class="action-button" onclick="explainLastAnswer()">
                                <i class="fas fa-question-circle"></i> –û–±—ä—è—Å–Ω–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ
                            </button>
                            <button class="action-button" onclick="showLearningTips()">
                                <i class="fas fa-lightbulb"></i> –°–æ–≤–µ—Ç—ã –ø–æ —É—á—ë–±–µ
                            </button>
                            <button class="action-button" onclick="toggleEmotionDisplay()">
                                <i class="fas fa-smile"></i> –≠–º–æ—Ü–∏–∏: –í–∫–ª
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div class="modal" id="neuroSettingsModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ NeuroLeo</h3>
                <button class="modal-close" onclick="closeNeuroSettings()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4>üß† –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—É—á–µ–Ω–∏—è</h4>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="autoLearn" checked>
                            –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ
                        </label>
                        <small>NeuroLeo –±—É–¥–µ—Ç —É—á–∏—Ç—å—Å—è –Ω–∞ –≤–∞—à–∏—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö</small>
                    </div>
                    
                    <div class="form-group">
                        <label>–°–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è</label>
                        <input type="range" id="learningRate" min="0.001" max="0.1" step="0.001" value="0.01">
                        <small>–¢–µ–∫—É—â–∞—è: <span id="learningRateValue">0.01</span></small>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>üíæ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏—è–º–∏</h4>
                    <div class="button-group">
                        <button class="btn-secondary" onclick="exportKnowledge()">
                            <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
                        </button>
                        <button class="btn-secondary" onclick="importKnowledge()">
                            <i class="fas fa-upload"></i> –ò–º–ø–æ—Ä—Ç –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
                        </button>
                        <button class="btn-danger" onclick="resetKnowledge()">
                            <i class="fas fa-trash"></i> –°–±—Ä–æ—Å–∏—Ç—å –∑–Ω–∞–Ω–∏—è
                        </button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
                    <div id="detailedStats">
                        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–¥–µ—Å—å -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Overlay -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeNeuroSettings()"></div>

    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script src="../js/config.js"></script>
    <script src="../js/core.js"></script>
    <script src="../js/neuro.js"></script>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        let neuroLeo;
        let conversation = [];
        let voiceEnabled = false;
        let speechSynthesis = window.speechSynthesis;
        
        document.addEventListener('DOMContentLoaded', async () => {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            if (!window.leoApp) {
                window.leoApp = initApp();
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è NeuroLeo
            neuroLeo = initNeuroLeo();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            await initNeuroInterface();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞
            loadSavedConversation();
            
            // –°–∫—Ä—ã—Ç–∏–µ –ø—Ä–µ–ª–æ–∞–¥–µ—Ä–∞
            setTimeout(() => {
                document.getElementById('preloader').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('preloader').style.display = 'none';
                }, 300);
            }, 500);
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            setTimeout(() => {
                document.getElementById('messageInput').focus();
            }, 1000);
        });
        
        async function initNeuroInterface() {
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –æ–ø—Ü–∏–∏ –ª–∏—á–Ω–æ—Å—Ç–∏
            const personalities = [
                { id: 'helpful_teacher', name: 'üë®‚Äçüè´ –ü–æ–º–æ—â–Ω—ã–π —É—á–∏—Ç–µ–ª—å', desc: '–¢–µ—Ä–ø–µ–ª–∏–≤—ã–π –∏ –æ–±—ä—è—Å–Ω—è—é—â–∏–π' },
                { id: 'funny_friend', name: 'üòÑ –í–µ—Å—ë–ª—ã–π –¥—Ä—É–≥', desc: '–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ —Å —é–º–æ—Ä–æ–º' },
                { id: 'strict_professor', name: 'üëì –°—Ç—Ä–æ–≥–∏–π –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä', desc: '–¢–æ—á–Ω—ã–π –∏ –∞–∫–∞–¥–µ–º–∏—á–Ω—ã–π' },
                { id: 'motivator', name: 'üöÄ –ú–æ—Ç–∏–≤–∞—Ç–æ—Ä', desc: '–í–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π –∏ —ç–Ω–µ—Ä–≥–∏—á–Ω—ã–π' }
            ];
            
            const optionsContainer = document.getElementById('personalityOptions');
            personalities.forEach(personality => {
                const option = document.createElement('div');
                option.className = 'personality-option';
                option.innerHTML = `
                    <i class="fas fa-user"></i>
                    <div>
                        <strong>${personality.name}</strong>
                        <small>${personality.desc}</small>
                    </div>
                `;
                option.onclick = () => changePersonality(personality.id);
                optionsContainer.appendChild(option);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateStatistics();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–Ω–∞–Ω–∏–π
            updateKnowledgeCategories();
        }
        
        function updateStatistics() {
            if (!neuroLeo) return;
            
            const stats = neuroLeo.getStatistics();
            
            document.getElementById('knowledgeCount').textContent = 
                `–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–Ω–∞–Ω–∏–π: ${stats.totalKnowledge}`;
            document.getElementById('totalDialogs').textContent = stats.totalConversations;
            document.getElementById('confidenceLevel').textContent = '85%';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –ª–∏—á–Ω–æ—Å—Ç—å –∏ —ç–º–æ—Ü–∏—é
            document.getElementById('currentPersonality').textContent = stats.personality;
            document.getElementById('emotionEmoji').textContent = 
                neuroLeo.emotions[stats.emotion].emoji;
            document.getElementById('emotionText').textContent = 
                this.getEmotionText(stats.emotion);
        }
        
        function getEmotionText(emotion) {
            const emotions = {
                'calm': '–°–ø–æ–∫–æ–π–Ω—ã–π',
                'happy': '–†–∞–¥–æ—Å—Ç–Ω—ã–π',
                'excited': '–í–∑–≤–æ–ª–Ω–æ–≤–∞–Ω–Ω—ã–π',
                'thoughtful': '–ó–∞–¥—É–º—á–∏–≤—ã–π',
                'concerned': '–û–∑–∞–±–æ—á–µ–Ω–Ω—ã–π'
            };
            return emotions[emotion] || '–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π';
        }
        
        function updateKnowledgeCategories() {
            if (!neuroLeo) return;
            
            const stats = neuroLeo.getStatistics();
            const categoriesContainer = document.getElementById('knowledgeCategories');
            categoriesContainer.innerHTML = '';
            
            for (const [category, count] of Object.entries(stats.categories)) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'stat-item';
                categoryDiv.innerHTML = `
                    <span class="category-${category.toLowerCase().replace(' ', '-')}">${category}:</span>
                    <span>${count}</span>
                `;
                categoriesContainer.appendChild(categoryDiv);
            }
        }
        
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            input.value = '';
            input.style.height = 'auto';
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —á–∞—Ç
            addMessageToChat(message, 'user');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞
            document.getElementById('typingIndicator').style.display = 'flex';
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç NeuroLeo
                const response = await askNeuroLeo(message);
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞
                document.getElementById('typingIndicator').style.display = 'none';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –≤ —á–∞—Ç
                addMessageToChat(response.text, 'ai', {
                    category: response.category,
                    confidence: response.confidence,
                    emotion: response.emotion,
                    emoji: response.emoji
                });
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
                conversation.push({
                    user: message,
                    ai: response,
                    timestamp: Date.now()
                });
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                saveConversation();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                updateStatistics();
                
                // –û–∑–≤—É—á–∏–≤–∞–µ–º –æ—Ç–≤–µ—Ç –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ
                if (voiceEnabled) {
                    speakText(response.text);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞:', error);
                document.getElementById('typingIndicator').style.display = 'none';
                
                addMessageToChat(
                    '–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.',
                    'ai',
                    { category: '–û—à–∏–±–∫–∞', confidence: 0 }
                );
            }
        }
        
        function addMessageToChat(text, sender, metadata = {}) {
            const messagesContainer = document.getElementById('chatMessages');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const timestamp = new Date().toLocaleTimeString('ru-RU', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            let categoryBadge = '';
            if (metadata.category && metadata.category !== '–û–±—â–µ–µ') {
                const categoryClass = `category-${metadata.category.toLowerCase().replace(' ', '-')}`;
                categoryBadge = `<span class="message-category ${categoryClass}">${metadata.category}</span>`;
            }
            
            let emotionBadge = '';
            if (metadata.emotion && metadata.emoji) {
                emotionBadge = `<span style="margin-left: 10px;">${metadata.emoji}</span>`;
            }
            
            messageDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-${sender === 'user' ? 'user' : 'brain'}"></i>
                </div>
                <div class="message-content">
                    <div class="message-text">${text}</div>
                    <div class="message-meta">
                        ${categoryBadge}
                        ${emotionBadge}
                        <span>${timestamp}</span>
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–∏–∞–ª–æ–≥–µ
            updateConversationInfo();
        }
        
        function updateConversationInfo() {
            const info = document.getElementById('conversationInfo');
            if (conversation.length > 0) {
                info.textContent = `–î–∏–∞–ª–æ–≥–æ–≤: ${conversation.length} ‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–∏–π: ${new Date().toLocaleTimeString('ru-RU')}`;
            }
        }
        
        function askQuestion(question) {
            document.getElementById('messageInput').value = question;
            sendMessage();
        }
        
        function changePersonality(personalityType) {
            if (!neuroLeo) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –æ–ø—Ü–∏—é
            document.querySelectorAll('.personality-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.closest('.personality-option').classList.add('active');
            
            // –ú–µ–Ω—è–µ–º –ª–∏—á–Ω–æ—Å—Ç—å
            const newPersonality = changeNeuroPersonality(personalityType);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Å–º–µ–Ω–µ –ª–∏—á–Ω–æ—Å—Ç–∏
            addMessageToChat(
                `–ü–µ—Ä–µ–∫–ª—é—á–∏–ª—Å—è –≤ —Ä–µ–∂–∏–º "${newPersonality.name}"! ${newPersonality.emoji}`,
                'ai',
                { category: '–°–∏—Å—Ç–µ–º–∞' }
            );
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            document.getElementById('currentPersonality').textContent = newPersonality.name;
        }
        
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const button = document.getElementById('voiceToggle');
            
            if (voiceEnabled) {
                button.innerHTML = '<i class="fas fa-microphone-slash"></i> –ì–æ–ª–æ—Å';
                button.classList.add('active');
                addMessageToChat('–ì–æ–ª–æ—Å–æ–≤–æ–π —Ä–µ–∂–∏–º –≤–∫–ª—é—á–µ–Ω üîä', 'ai', { category: '–°–∏—Å—Ç–µ–º–∞' });
            } else {
                button.innerHTML = '<i class="fas fa-microphone"></i> –ì–æ–ª–æ—Å';
                button.classList.remove('active');
                speechSynthesis.cancel();
                addMessageToChat('–ì–æ–ª–æ—Å–æ–≤–æ–π —Ä–µ–∂–∏–º –≤—ã–∫–ª—é—á–µ–Ω üîá', 'ai', { category: '–°–∏—Å—Ç–µ–º–∞' });
            }
        }
        
        function speakText(text) {
            if (!speechSynthesis || !voiceEnabled) return;
            
            speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ru-RU';
            utterance.rate = 0.9;
            utterance.pitch = 1;
            utterance.volume = 1;
            
            speechSynthesis.speak(utterance);
        }
        
        function handleInputKeydown(event) {
            // –ê–≤—Ç–æ—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è
            const textarea = event.target;
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ Enter (–±–µ–∑ Shift)
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }
        
        function insertExample() {
            const examples = [
                '–û–±—ä—è—Å–Ω–∏ —Ç–µ–æ—Ä–µ–º—É –ü–∏—Ñ–∞–≥–æ—Ä–∞ –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏',
                '–ö–∞–∫ —Ä–µ—à–∞—Ç—å –∑–∞–¥–∞—á–∏ –Ω–∞ –ø—Ä–æ—Ü–µ–Ω—Ç—ã?',
                '–†–∞—Å—Å–∫–∞–∂–∏ –æ –í–µ–ª–∏–∫–æ–π –û—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –≤–æ–π–Ω–µ',
                '–ß—Ç–æ —Ç–∞–∫–æ–µ —Ñ–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑ –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω?',
                '–ü–æ–º–æ–≥–∏ —Å –≥—Ä–∞–º–º–∞—Ç–∏–∫–æ–π –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞'
            ];
            
            const randomExample = examples[Math.floor(Math.random() * examples.length)];
            document.getElementById('messageInput').value = randomExample;
            document.getElementById('messageInput').focus();
        }
        
        function explainLastAnswer() {
            if (conversation.length > 0) {
                const lastQuestion = conversation[conversation.length - 1].user;
                document.getElementById('messageInput').value = `–û–±—ä—è—Å–Ω–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ: ${lastQuestion}`;
                sendMessage();
            } else {
                addMessageToChat('–°–Ω–∞—á–∞–ª–∞ –∑–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å!', 'ai', { category: '–°–∏—Å—Ç–µ–º–∞' });
            }
        }
        
        function showLearningTips() {
            const tips = [
                'üéØ –°—Ç–∞–≤—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–µ–ª–∏ –Ω–∞ –∫–∞–∂–¥–æ–µ –∑–∞–Ω—è—Ç–∏–µ',
                '‚è∞ –ó–∞–Ω–∏–º–∞–π—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ –ø–æ 30-40 –º–∏–Ω—É—Ç',
                'üìù –î–µ–ª–∞–π –∫–æ—Ä–æ—Ç–∫–∏–µ –∫–æ–Ω—Å–ø–µ–∫—Ç—ã —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏',
                'üîÑ –ü–æ–≤—Ç–æ—Ä—è–π –º–∞—Ç–µ—Ä–∏–∞–ª —á–µ—Ä–µ–∑ –¥–µ–Ω—å, –Ω–µ–¥–µ–ª—é –∏ –º–µ—Å—è—Ü',
                '‚ùì –ù–µ –±–æ–π—Å—è –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ',
                'üéÆ –ò—Å–ø–æ–ª—å–∑—É–π –∏–≥—Ä–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è',
                'üí§ –í—ã—Å—ã–ø–∞–π—Å—è ‚Äî —Å–æ–Ω –ø–æ–º–æ–≥–∞–µ—Ç –∑–∞–∫—Ä–µ–ø–∏—Ç—å –∑–Ω–∞–Ω–∏—è',
                'üö´ –£–±–∏—Ä–∞–π –æ—Ç–≤–ª–µ–∫–∞—é—â–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã –≤–æ –≤—Ä–µ–º—è —É—á—ë–±—ã'
            ];
            
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            addMessageToChat(randomTip, 'ai', { category: '–°–æ–≤–µ—Ç—ã' });
        }
        
        function toggleEmotionDisplay() {
            const button = event.target;
            const messages = document.querySelectorAll('.message.ai .message-meta');
            
            messages.forEach(message => {
                const emotionSpan = message.querySelector('span:nth-child(2)');
                if (emotionSpan) {
                    emotionSpan.style.display = 
                        emotionSpan.style.display === 'none' ? 'inline' : 'none';
                }
            });
            
            button.innerHTML = button.innerHTML.includes('–í–∫–ª') ? 
                '<i class="fas fa-smile"></i> –≠–º–æ—Ü–∏–∏: –í—ã–∫–ª' : 
                '<i class="fas fa-smile"></i> –≠–º–æ—Ü–∏–∏: –í–∫–ª';
        }
        
        function exportConversation() {
            const exportData = {
                date: new Date().toISOString(),
                conversation: conversation,
                statistics: neuroLeo ? neuroLeo.getStatistics() : null
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `neuroleo-conversation-${Date.now()}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            addMessageToChat('–î–∏–∞–ª–æ–≥ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ JSON —Ñ–∞–π–ª üì•', 'ai', { category: '–°–∏—Å—Ç–µ–º–∞' });
        }
        
        function clearConversation() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞?')) {
                conversation = [];
                document.getElementById('chatMessages').innerHTML = `
                    <div class="message ai">
                        <div class="message-avatar">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="message-content">
                            <div class="message-text">
                                –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ –æ—á–∏—â–µ–Ω–∞. –ó–∞–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å! üîÑ
                            </div>
                            <div class="message-meta">
                                <span class="message-category">–°–∏—Å—Ç–µ–º–∞</span>
                                <span>–¢–æ–ª—å–∫–æ —á—Ç–æ</span>
                            </div>
                        </div>
                    </div>
                `;
                
                localStorage.removeItem('neuroleo_conversation');
                updateConversationInfo();
            }
        }
        
        function saveConversation() {
            localStorage.setItem('neuroleo_conversation', JSON.stringify(conversation));
        }
        
        function loadSavedConversation() {
            const saved = localStorage.getItem('neuroleo_conversation');
            if (saved) {
                try {
                    conversation = JSON.parse(saved);
                    
                    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä
                    if (conversation.length > 20) {
                        conversation = conversation.slice(-20);
                    }
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Å–æ–æ–±—â–µ–Ω–∏–π
                    const recent = conversation.slice(-5);
                    recent.forEach(msg => {
                        addMessageToChat(msg.user, 'user');
                        addMessageToChat(msg.ai.text, 'ai', {
                            category: msg.ai.category,
                            confidence: msg.ai.confidence
                        });
                    });
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∏–∞–ª–æ–≥–∞:', error);
                }
            }
        }
        
        function showNeuroSettings() {
            document.getElementById('neuroSettingsModal').classList.add('active');
            document.getElementById('modalOverlay').style.display = 'block';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            if (neuroLeo) {
                const stats = neuroLeo.getStatistics();
                const detailedStats = document.getElementById('detailedStats');
                detailedStats.innerHTML = `
                    <div class="stat-item"><span>–í—Å–µ–≥–æ –∑–Ω–∞–Ω–∏–π:</span><span>${stats.totalKnowledge}</span></div>
                    <div class="stat-item"><span>–í—Å–µ–≥–æ –¥–∏–∞–ª–æ–≥–æ–≤:</span><span>${stats.totalConversations}</span></div>
                    <div class="stat-item"><span>–†–∞–∑–º–µ—Ä –ø–∞–º—è—Ç–∏:</span><span>${stats.memorySize}</span></div>
                    <div class="stat-item"><span>–¢–µ–∫—É—â–∞—è –ª–∏—á–Ω–æ—Å—Ç—å:</span><span>${stats.personality}</span></div>
                    <div class="stat-item"><span>–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:</span><span>${stats.emotion}</span></div>
                `;
            }
        }
        
        function closeNeuroSettings() {
            document.getElementById('neuroSettingsModal').classList.remove('active');
            document.getElementById('modalOverlay').style.display = 'none';
        }
        
        function exportKnowledge() {
            if (neuroLeo) {
                const knowledge = exportNeuroKnowledge();
                const dataStr = 'data:application/json;charset=utf-8,' + encodeURIComponent(knowledge);
                const link = document.createElement('a');
                link.setAttribute('href', dataStr);
                link.setAttribute('download', `neuroleo-knowledge-${Date.now()}.json`);
                link.click();
                
                addMessageToChat('–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ üß†', 'ai', { category: '–°–∏—Å—Ç–µ–º–∞' });
            }
        }
        
        function importKnowledge() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    if (importNeuroKnowledge(e.target.result)) {
                        addMessageToChat('–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ üì•', 'ai', { category: '–°–∏—Å—Ç–µ–º–∞' });
                        updateStatistics();
                        updateKnowledgeCategories();
                    } else {
                        addMessageToChat('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π ‚ùå', 'ai', { category: '–°–∏—Å—Ç–µ–º–∞' });
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        function resetKnowledge() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ —Å–±—Ä–æ—Å–∏—Ç –≤—Å–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞–Ω–∏—è –∫ –±–∞–∑–æ–≤—ã–º.')) {
                if (neuroLeo) {
                    neuroLeo.resetKnowledge();
                    addMessageToChat('–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —Å–±—Ä–æ—à–µ–Ω–∞ –∫ –±–∞–∑–æ–≤–æ–π üîÑ', 'ai', { category: '–°–∏—Å—Ç–µ–º–∞' });
                    updateStatistics();
                    updateKnowledgeCategories();
                }
            }
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–∑—É–Ω–æ–∫ —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ–±—É—á–µ–Ω–∏—è
        document.getElementById('learningRate')?.addEventListener('input', function() {
            document.getElementById('learningRateValue').textContent = this.value;
            if (neuroLeo) {
                neuroLeo.learningRate = parseFloat(this.value);
            }
        });
    </script>
</body>
</html>
